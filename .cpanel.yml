---
deployment:
  tasks:
    # 1. Copiar arquivos do repo para o site
    - export DEPLOYPATH=/home1/abdonc73/iagus.com.br
    - /bin/cp -R . $DEPLOYPATH

    # 2. Instalar dependências PHP (platform-check desabilitado - funciona com PHP 8.3)
    - cd /home1/abdonc73/iagus.com.br && /usr/local/bin/php /usr/local/bin/composer install --no-dev --optimize-autoloader --no-interaction 2>&1

    # 3. Limpar caches antigos
    - cd /home1/abdonc73/iagus.com.br && /usr/local/bin/php artisan optimize:clear 2>&1

    # 4. Rodar migrations
    - cd /home1/abdonc73/iagus.com.br && /usr/local/bin/php artisan migrate --force 2>&1

    # 5. Cache de produção
    - cd /home1/abdonc73/iagus.com.br && /usr/local/bin/php artisan optimize 2>&1

    # 6. Criar symlink de storage
    - cd /home1/abdonc73/iagus.com.br && /usr/local/bin/php artisan storage:link --relative 2>&1

    # 7. Permissões
    - chmod -R 775 /home1/abdonc73/iagus.com.br/storage
    - chmod -R 775 /home1/abdonc73/iagus.com.br/bootstrap/cache
